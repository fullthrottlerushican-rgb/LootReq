<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Guild Loot Request</title>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 720px;
      margin: 3rem auto;
      padding: 0 1.5rem;
      background: linear-gradient(135deg, #0d0d1a 0%, #141428 100%);
      color: #e8e8ff;
      line-height: 1.6;
    }

    h1 {
      text-align: center;
      color: #ffd700;
      text-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
      font-size: 2.6rem;
      margin-bottom: 0.8rem;
      letter-spacing: 1px;
    }

    .subtitle {
      text-align: center;
      color: #aaaaff;
      font-size: 1.15rem;
      margin-bottom: 2.5rem;
      opacity: 0.9;
    }

    form {
      background: rgba(20, 20, 40, 0.75);
      border-radius: 16px;
      padding: 2.5rem 2rem;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.6),
                  inset 0 0 20px rgba(255, 215, 0, 0.08);
      border: 1px solid rgba(255, 215, 0, 0.15);
      backdrop-filter: blur(6px);
    }

    label {
      display: block;
      margin: 1.6rem 0 0.6rem;
      font-weight: 600;
      color: #d4d4ff;
      font-size: 1.05rem;
    }

    input, select {
      width: 100%;
      padding: 0.85rem 1rem;
      background: rgba(30, 30, 60, 0.6);
      border: 1px solid rgba(255, 215, 0, 0.4);
      border-radius: 10px;
      color: white;
      font-size: 1.05rem;
      transition: all 0.22s ease;
      box-shadow: inset 0 2px 8px rgba(0,0,0,0.3);
    }

    input:focus, select:focus {
      outline: none;
      border-color: #ffd700;
      box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.35);
      background: rgba(40, 40, 70, 0.8);
    }

    /* Gold calendar picker icon (Chrome/Edge/Safari) */
    input[type="date"]::-webkit-calendar-picker-indicator {
      filter: invert(0.8) sepia(1) saturate(5) hue-rotate(20deg) brightness(1.1);
      cursor: pointer;
      opacity: 0.9;
    }

    input[type="date"]::-webkit-calendar-picker-indicator:hover {
      filter: invert(0.9) sepia(1) saturate(6) hue-rotate(25deg) brightness(1.2);
    }

    /* Firefox fallback styling for date picker */
    input[type="date"] {
      color-scheme: dark;
    }

    input[type="date"]::-moz-focus-inner {
      border: 0;
    }

    .checkbox {
      margin: 2rem 0;
      display: flex;
      align-items: center;
      gap: 0.8rem;
    }

    .checkbox input {
      width: auto;
      transform: scale(1.3);
    }

    .checkbox label {
      margin: 0;
      color: #ffdddd;
      font-weight: normal;
      cursor: pointer;
    }

    button {
      width: 100%;
      padding: 1.1rem;
      background: linear-gradient(90deg, #d32f2f, #b71c1c);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 1.25rem;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.25s ease;
      box-shadow: 0 6px 20px rgba(178, 34, 34, 0.4);
      margin-top: 1.5rem;
    }

    button:hover {
      background: linear-gradient(90deg, #e53935, #c62828);
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(178, 34, 34, 0.6);
    }

    button:active {
      transform: translateY(1px);
    }

    #status {
      margin-top: 1.8rem;
      padding: 1.4rem;
      border-radius: 12px;
      text-align: center;
      font-size: 1.15rem;
    }

    .success {
      background: rgba(30, 60, 30, 0.4);
      color: #aaffaa;
      border: 1px solid #66aa66;
    }

    .error {
      background: rgba(80, 20, 20, 0.4);
      color: #ffaaaa;
      border: 1px solid #aa4444;
    }

    #successScreen {
      display: none;
      text-align: center;
      animation: fadeInScale 0.9s ease-out forwards;
      padding: 2rem;
    }

    @keyframes fadeInScale {
      0% { opacity: 0; transform: scale(0.92); }
      100% { opacity: 1; transform: scale(1); }
    }

    #checkmark {
      width: 140px;
      height: 140px;
      margin: 1.5rem auto 2rem;
    }

    .checkmark-circle {
      stroke-dasharray: 166;
      stroke-dashoffset: 166;
      stroke-width: 2.5;
      stroke: #7ac142;
      fill: none;
      animation: stroke 0.7s cubic-bezier(0.65, 0, 0.45, 1) forwards;
    }

    .checkmark-check {
      stroke-dasharray: 56;
      stroke-dashoffset: 56;
      animation: stroke 0.4s cubic-bezier(0.65, 0, 0.45, 1) 0.7s forwards;
    }

    @keyframes stroke {
      100% { stroke-dashoffset: 0; }
    }
  </style>
</head>
<body>

<div id="formContainer">
  <h1>Guild Loot Request</h1>
  <div class="subtitle">Submit your claim — may the loot gods be merciful</div>

  <form id="lootForm">
    <label for="ingameName">In-game Name</label>
    <input type="text" id="ingameName" name="ingameName" required placeholder="Your character name">

    <label for="requestDate">Desired Date / Raid</label>
    <input type="date" id="requestDate" name="requestDate" required>

    <label for="item">Item Requested</label>
    <input type="text" id="item" name="item" required placeholder="e.g. Thunderfury, Blessed Blade of the Windseeker">

    <label for="requiredItems">Missing pieces to complete (0 = main spec priority)</label>
    <select id="requiredItems" name="requiredItems" required>
      <option value="">Select number...</option>
      <script>
        for(let i = 0; i <= 200; i++) {
          document.write(`<option value="${i}">${i}</option>`);
        }
      </script>
    </select>

    <div class="checkbox">
      <input type="checkbox" id="oath" name="oath" value="yes" required>
      <label for="oath">I swear I will not blow this fucking item up</label>
    </div>

    <button type="submit">Submit Request</button>
  </form>

  <div id="status"></div>
</div>

<div id="successScreen">
  <svg id="checkmark" viewBox="0 0 52 52">
    <circle class="checkmark-circle" cx="26" cy="26" r="25" fill="none"/>
    <path class="checkmark-check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
  </svg>
  <h2>May the Odds Be Ever in Your Favor...</h2>
  <p>
    Your request for <strong id="submittedItem"></strong> has been delivered to the council.<br><br>
    Go forth — may RNGesus bless your next roll.
  </p>
  <button onclick="resetForm()">Make Another Request</button>
</div>

<script>
  const form = document.getElementById("lootForm");
  const statusDiv = document.getElementById("status");
  const formContainer = document.getElementById("formContainer");
  const successScreen = document.getElementById("successScreen");
  const submittedItemEl = document.getElementById("submittedItem");

  // Paste your Google Apps Script /exec URL here
  const GAS_URL = "https://script.google.com/macros/s/AKfycbwipedpLC3Hh4m_0lL1WbaApJ4KSOc6fslfb7OAuRQ59gm5nAoktrp_VyY_KWkyRUKybQ/exec";

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    statusDiv.textContent = "Submitting request...";
    statusDiv.className = "";

    try {
      const formData = new FormData(form);

      const response = await fetch(GAS_URL, {
        method: "POST",
        body: formData
      });

      const text = await response.text();
      const result = JSON.parse(text);

      if (result.result === "success") {
        submittedItemEl.textContent = formData.get("item") || "that shiny thing";
        formContainer.style.display = "none";
        successScreen.style.display = "block";
        statusDiv.textContent = "";

        const duration = 3 * 1000;
        const end = Date.now() + duration;
        (function frame() {
          confetti({
            particleCount: 5,
            angle: 60,
            spread: 55,
            origin: { x: 0 },
            colors: ['#ffd700', '#ffaa00', '#ff4444', '#4CAF50']
          });
          confetti({
            particleCount: 5,
            angle: 120,
            spread: 55,
            origin: { x: 1 },
            colors: ['#ffd700', '#ffaa00', '#ff4444', '#4CAF50']
          });
          if (Date.now() < end) requestAnimationFrame(frame);
        }());

        setTimeout(() => {
          confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
        }, 500);
      } else {
        throw new Error(result.error || "Server error");
      }
    } catch (err) {
      statusDiv.textContent = "Error: " + err.message;
      statusDiv.className = "error";
    }
  });

  function resetForm() {
    form.reset();
    formContainer.style.display = "block";
    successScreen.style.display = "none";
    statusDiv.textContent = "";
    statusDiv.className = "";
  }
</script>

</body>
</html>

